$=function(a){return new _$(a)};$.extend=function(){function a(b,d){for(var h in b){var f=b[h],g=f&&f.constructor;d[h]=c&&g&&(g==Array||g==Object)?a(f,new g):!g||g!=Number&&g!=String?f:e&&g==String&&d[h]&&d[h].constructor==String?d[h]+" "+f:g(f)}return d}for(var b=arguments,c=!0===b[0],d=b[c&&1||0],e=b[c&&3||2],f=c?2:1;f<b.length;f++)a(b[f],d);return d};
function _getEls(a,b){if(a==window)return[window];if(a instanceof Element)return[a];if(a instanceof Array||a instanceof _$)return a;if(/^\</.test(a)){var c=document.createElement("div");c.innerHTML=a;return c.childNodes}return a?(b||document).querySelectorAll(a):[]}function _$(a,b){var c=_getEls(a,b),d;for(d in c)this[d]=c[d];this.length||(this.length=c.length)}
_$.prototype={each:function(a){for(var b=0;b<this.length;b++)a.call(this[b]);return this},remove:function(){this.each(function(){this.parentNode&&this.parentNode.removeChild(this)});return this},clone:function(a){var b=[];this.each(function(){var c=this.cloneNode(!a);c._originalNode=this;b.push(c)});return $(b)},replaceWith:function(a){var b=this;b[0]&&(a.each?a.each(function(){b[0].parentNode.insertBefore(this,b[0])}):b[0].parentNode.insertBefore(a,b[0]),b.remove());return this},insertBefore:function(a){a=
a.length?a[0]:a;this.each(function(){a.parentNode.insertBefore(this,a)})},prependTo:function(a){a="string"==typeof a?$(a)[0]:a.length?a[0]:a;this.each(function(){a.insertBefore(this,a.firstChild)});return this},appendTo:function(a){a="string"==typeof a?$(a)[0]:a.length?a[0]:a;this.each(function(){a.appendChild(this)});return this},append:function(a){this[0]&&$(a).appendTo(this[0]);return this},parent:function(){var a=[];this.each(function(){0>a.indexOf(this.parentNode)&&a.push(this.parentNode)});
return new _$(a)},closest:function(a){var b=[];this.each(function(){for(var c=this;c=c.parentNode;)if($(c).filter(a)[0])return 0>b.indexOf(c)&&b.push(c)});return new _$(b)},children:function(a){var b="string"==typeof a?a:"*",c=[];this.each(function(){for(var d=this.querySelectorAll(b),e=0;e<d.length;e++)d[e].parentNode==this&&(a instanceof _$?a.has(d[e]):1)&&c.push(d[e])});return new _$(c)},siblings:function(a){var b=[],c=this;this.parent().children().filter(a).each(function(){!c.has(this)&&0>b.indexOf(this)&&
b.push(this)});return new _$(b)},nextAll:function(a){var b=this.siblings(a),c=this,d=-1,e=!1,f=!1,k=[];this.parent().children().each(function(){f||(e?b.has(this)?k.push(this):f=!0:(d++,e=this==c[0]))});return new _$(k)},find:function(a){return new _$(a,this[0])},filter:function(a,b){a=$("<div>").append(this.clone(!0)).children(a);return new _$([].filter.call(this,function(c){for(var d=0;d<a.length;d++)if(a[d]._originalNode==c)return!b;return!!b}))},not:function(a){return this.filter(a,!0)},eq:function(a){return new _$(this[a])},
has:function(a){for(var b=0;b<this.length;b++)if(this[b]._originalNode==a||this[b]==a._originalNode||this[b]==a)return!0;return!1},add:function(a){a=_getEls(a);for(var b=[],c=0;c<this.length;c++)b.push(this[c]);a=b.concat([].filter.call(a,function(a){return-1==b.indexOf(a)}));return a.length==this.length?this:new _$(a)},attr:function(a,b){if(void 0===b)return this[0]&&this[0].getAttribute(a);this.each(function(){this[(null===b?"remove":"set")+"Attribute"](a,b)});return this},trigger:function(a,b){this.each(function(){var c=
!$.browser.ie&&window.CustomEvent?new CustomEvent(a,{detail:b}):document.createEvent("CustomEvent");!$.browser.ie&&window.CustomEvent||c.initCustomEvent(a,!1,!1,b);this.dispatchEvent(c)});return this},on:function(a,b){a=a.split(" ");this.each(function(){for(var c in a)this.addEventListener(a[c],b)});return this},off:function(a,b){a=a.split(" ");this.each(function(){for(var c in a)this.removeEventListener(a[c],b)});return this},click:function(a){if(a instanceof Function)this.on("click",a);else this.trigger("click");
return this},text:function(a){if(void 0===a)return this[0]&&this[0].textContent;this.each(function(){this.textContent=a});return this},html:function(a){if(void 0===a)return this[0]&&this[0].innerHTML;this.each(function(){this.innerHTML=a});return this},hasClass:function(a,b){b=0;this.each(function(){b+=this.classList.contains(a)&&1||0});return!!b},addClass:function(a){a=a.split(" ");this.each(function(){for(var b in a)a[b]&&this.classList.add(a[b])});return this},removeClass:function(a){a=a.split(" ");
this.each(function(){for(var b in a)a[b]&&this.classList.remove(a[b])});return this},toggleClass:function(a){a=a.split(" ");for(var b in a)if(a[b])this[(this.hasClass(a[b])?"remove":"add")+"Class"](a[b]);return this},setcss:function(a,b){this.each(function(){this.style.setProperty(a,b)});return this},getcss:function(a){return this[0]&&this[0].style.getPropertyValue(a)},css:function(a,b){if("string"==typeof a){if(void 0===b)return this.getcss(a);this.setcss(a,b)}else for(var c in a)this.setcss(c,a[c]);
return this},hide:function(){this.setcss("display","none");return this},show:function(){this.setcss("display","block");return this},width:function(){return this[0]&&this[0].clientWidth},height:function(){return this[0]&&this[0].clientHeight}};
$.browser=new function(){var a=navigator.userAgent.toLowerCase();this.webkit=/applewebkit/.test(a);this.firefox=/firefox/.test(a);this.safari=/safari/.test(a)&&!/chrome/.test(a);this.ie=/msie/.test(a)||/trident/.test(a);this.iemobile=/iemobile/.test(a);this.iOS=/ipad|iphone|ipod/.test(a);this.android=/android/.test(a);this.mobile=this.iOS||this.android||this.iemobile;this.unknown=!this.webkit&&!this.firefox&&!this.ie&&!this.iOS&&!this.android;this.version=parseFloat(this.webkit?a.match(/applewebkit\/(\d+)\./)[1]:
this.firefox?a.match(/firefox\/(\d+)\./)[1]:this.ie?a.match(/(msie\s|rv\:)(\d+)\./)[2]:-1);this.retina=window.devicePixelRatio&&2<=window.devicePixelRatio&&this.iOS};function Controller(){this.cpu=new CPU(this);this.gpu=new GPU(this);this.net=new Net(this);this.slider=new Slider(this);this.started=!1;this.audio=[]}
Controller.prototype={init:function(){this.cpu.init();this.gpu.init();this.slider.init();var a=navigator.userAgent.toLowerCase();(this.isMobile=/ipad|iphone|ipod/.test(a)||/android/.test(a))&&document.documentElement.classList.add("mobile");var b=this;this.slider.onchange=function(a){b[b.started?"stop":"start"]()}},start:function(){if(!this.started){this.started=!0;this.cpu.start();this.gpu.start();this.net.start();document.documentElement.classList.add("started");this.playAudio("audio/switch.mp3");
this.playAudio("audio/noise.mp3");var a=this;this._to1=setTimeout(function(){a.playAudio("audio/shatter.mp3")},92500);this._to2=setTimeout(function(){a.playAudio("audio/shatter.mp3")},152500)}},stop:function(){this.started&&(this.started=!1,this.cpu.stop(),this.gpu.stop(),this.net.stop(),document.documentElement.classList.remove("started"),this.playAudio("audio/switch.mp3"),this.stopAudio("audio/noise.mp3"),clearTimeout(this._to1),clearTimeout(this._to2))},getAudio:function(a){var b=this.audio[a];
b||(b=this.audio[a]=new Audio,b.src=a);return b},playAudio:function(a){this.getAudio(a).play()},stopAudio:function(a){this.getAudio(a).pause();this.getAudio(a).currentTime=0}};function CPU(a){this.controller=a;this.workers=[];this.numCores=0}
CPU.prototype={init:function(){if(this.compatible=window.URL&&window.Blob&&!/Trident/.test(navigator.userAgent))this.program=URL.createObjectURL(new Blob(["while(true){}"],{type:"text/javascript"})),this.numCores=(navigator.hardwareConcurrency||3)-1},start:function(){if(this.compatible){console.info("Starting CPU..");for(var a=0;a<this.numCores;a++)this.addWorker()}},stop:function(){for(console.info("Stopping CPU..");this.workers.length;)this.removeWorker()},addWorker:function(){this.workers.push(new Worker(this.program))},
removeWorker:function(){this.workers.shift().terminate()}};function GPU(a){this.controller=a;this.shaders=[];this.started=!1;this.gl=null;this.error=!1;this.fragmentShader=this.vertexShader=this.quad=null;this.fps=this.drawn=0;this.focussed=!0;this.size=256;this._raf=null;this._i=0;this._pos=this._time=this._now=null}
GPU.prototype={_canvas:document.querySelector("#webgl"),init:function(){this.error=/MSIE/.test(navigator.userAgent);if(!this.error)try{this.gl=this._canvas.getContext("webgl")||this._canvas.getContext("experimental-webgl");if(!window.WebGLRenderingContext)throw"Your browser does not support WebGL.";this.gl.viewportWidth=this.size;this.gl.viewportHeight=this.size}catch(a){this.error=!0}if(this.error)return console.warn("Could not initialize WebGL");this.vertexShader=Shaders.getShader("vertex",this.gl);
this.fragmentShader=Shaders.getShader("fragment",this.gl);this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE);this.gl.enable(this.gl.BLEND);this.gl.clearColor(0,0,0,0);this.gl.viewport(0,0,this.size,this.size);this.quad=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.quad);this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,1,-1,1,1,-1,1]),this.gl.STATIC_DRAW);var b=this;addEventListener("focus",function(){b.focussed=!0});addEventListener("blur",function(){b.focussed=
!1})},start:function(){if(!this.started&&!this.error){this.started=!0;console.info("Starting GPU..");var a=this;(function c(){a._raf=requestAnimationFrame(c);a.draw()})();this._int=setInterval(function(){a.fps=a.drawn;a.drawn=0;if(a.focussed&&40<=a.fps)for(var c=0;15>c;c++)a.addShader()},1E3);this.addShader()}},stop:function(){if(this.started){this.started=!1;console.info("Stopping GPU..");cancelAnimationFrame(this._raf);clearInterval(this._int);var a=this;setTimeout(function(){for(;a.shaders.length;)a.shaders.shift()},
1500)}},addShader:function(){var a=this.gl.createProgram();a.start=Date.now();this.gl.attachShader(a,this.vertexShader);this.gl.attachShader(a,this.fragmentShader);this.gl.linkProgram(a);this.gl.getProgramParameter(a,this.gl.LINK_STATUS)?this.shaders.push(a):console.warn("Could not initialise shaders")},draw:function(){this.gl.clear(this.gl.COLOR_BUFFER_BIT);this._now=Date.now();for(this._i=0;this._i<this.shaders.length;this._i++)this._pos=this.gl.getAttribLocation(this.shaders[this._i],"position"),
this._time=this.gl.getUniformLocation(this.shaders[this._i],"time"),this.gl.useProgram(this.shaders[this._i]),this.gl.uniform1f(this._time,(this._now-this.shaders[this._i].start)/1E3),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.quad),this.gl.vertexAttribPointer(this._pos,2,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(this._pos),this.gl.drawArrays(this.gl.TRIANGLES,0,6),this.gl.disableVertexAttribArray(this._pos);this.drawn++}};
var Shaders={vertex:"attribute vec2 position;\nvarying vec2 pos;\nvoid main() {\n  gl_Position = vec4(position.x,position.y,0.0,1.0);\n  pos = position;\n}",fragment:"#ifdef GL_ES\nprecision highp float;\n#endif\nuniform float time;\nvarying vec2 pos;\nvoid main(){\n  gl_FragColor = vec4(1.,.5,.1,((1.-length(pos))*.5)*time*.1);\n}",getShader:function(a,b){var c=b.createShader("fragment"==a?b.FRAGMENT_SHADER:b.VERTEX_SHADER);b.shaderSource(c,Shaders[a]);b.compileShader(c);b.getShaderParameter(c,b.COMPILE_STATUS)||
console.error("Shader Syntax Error in ["+a+"]:\n"+b.getShaderInfoLog(c));return c}};function Net(a){this.controller=a;this.connections=[];this.totalConnections=0;this._int=null}
Net.prototype={init:function(){},start:function(){if(!this.started){this.started=!0;console.info("Starting network..");var a=this;this._int=setInterval(function(){a.addConnection()},500)}},stop:function(){this.started&&(this.started=!1,console.info("Stopping network.."),clearInterval(this._int))},addConnection:function(){var a=this,b=new Image;b.onload=b.onerror=function(){for(var c=0;c<a.connections.length;c++)if(a.connections[c]==b){a.connections.splice(c,1);break}};b.src="http://www.google-analytics.com/__utm.gif?"+
Math.random();this.connections.push(b);this.totalConnections++}};function Slider(a,b){this.margin=40;this.currentOn=this.swiping=!1}
Slider.prototype={_element:document.querySelector(".slider"),_button:document.querySelector(".slider>.button"),_on:document.querySelector(".slider>.on"),_off:document.querySelector(".slider>.off"),init:function(){function a(a){a.originalEvent&&(a=a.originalEvent);return/^touch/.test(a.type)?a.changedTouches[0].clientX:a.clientX}function b(b){b.stopPropagation();b.preventDefault();k=(520<innerWidth&&2||1)*(a(b)-f);e.moveTo(l+k)}function c(a){setTimeout(function(){e.swiping=!1},10);a.stopPropagation();
a.preventDefault();m.off("touchmove mousemove",b).off("touchend touchcancel touchleave mouseup click",c);e.moveTo(l+k);l=h;d()}function d(){var a=Math.round(l/(g-2*e.margin));if(a!=e.currentOn&&e.onchange)e.onchange(!!a);e.currentOn=a;e.moveTo(a?g:0);l=h}var e=this;this.$cnt=$(this._element);this.$=$(this._button);var f=0,k=0,l=0,h=0,m=$(window),g=this.$cnt[0].offsetWidth;this.moveTo=function(a){var b=g-2*e.margin;e.$[0].style.left=(h=Math.max(0,Math.min(b,a)))+"px";e._off.style.width=b-h+"px";e._on.style.width=
h+"px"};this.$.on("touchstart mousedown",function(d){e.swiping||"mousedown"==d.type&&1!=d.which||(d.stopPropagation(),d.preventDefault(),m.on("touchmove mousemove",b).on("touchend touchcancel touchleave mouseup click",c),e.swiping=!0,f=a(d))})}};controller=new Controller;controller.init();
